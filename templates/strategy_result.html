<!-- templates/strategy_result.html -->
{% extends "base.html" %}

{% block title %}Strategy Analysis - {{ symbol }}{% endblock %}

{% block extra_css %}
<style>
.result-container {
  background: white;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  overflow: hidden;
}

.header-section {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 30px;
  text-align: center;
}

.header-section h1 {
  margin: 0;
  font-size: 2.5em;
  font-weight: 300;
}

.header-section .company-name {
  font-size: 1.2em;
  opacity: 0.9;
  margin-top: 10px;
}

.header-section .analysis-period {
  background: rgba(255, 255, 255, 0.2);
  display: inline-block;
  padding: 8px 16px;
  border-radius: 20px;
  margin-top: 15px;
  font-size: 0.9em;
}

.content-section {
  padding: 30px;
}

.chart-container {
  background: #f8f9fa;
  border-radius: 10px;
  padding: 20px;
  margin: 20px 0;
  border-left: 4px solid #28a745;
}

.chart-container h2 {
  color: #2c3e50;
  margin-top: 0;
  margin-bottom: 20px;
  font-size: 1.6em;
  display: flex;
  align-items: center;
  gap: 10px;
}

.chart-wrapper {
  background: white;
  border-radius: 8px;
  padding: 15px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.strategy-notes {
  background: #e8f5e8;
  border-radius: 10px;
  padding: 25px;
  margin: 30px 0;
  border-left: 4px solid #28a745;
}

.strategy-notes h2 {
  color: #155724;
  margin-top: 0;
  margin-bottom: 20px;
  font-size: 1.6em;
  display: flex;
  align-items: center;
  gap: 10px;
}

.strategy-notes .note-item {
  background: white;
  padding: 15px;
  margin: 10px 0;
  border-radius: 8px;
  border-left: 3px solid #28a745;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
}

.strategy-notes .note-item h4 {
  color: #155724;
  margin: 0 0 8px 0;
  font-size: 1.1em;
}

.strategy-notes .note-item p {
  color: #155724;
  margin: 0;
  line-height: 1.5;
}

.info-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin: 30px 0;
}

.info-card {
  background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
  color: white;
  padding: 20px;
  border-radius: 10px;
  text-align: center;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s ease;
}

.info-card:hover {
  transform: translateY(-3px);
}

.info-card h3 {
  margin: 0 0 10px 0;
  font-size: 1.1em;
  opacity: 0.9;
}

.info-card .value {
  font-size: 1.8em;
  font-weight: bold;
}

.analysis-summary {
  background: #fff3cd;
  border: 1px solid #ffeaa7;
  border-radius: 10px;
  padding: 20px;
  margin: 20px 0;
}

.analysis-summary h3 {
  color: #856404;
  margin-top: 0;
  display: flex;
  align-items: center;
  gap: 10px;
}

.analysis-summary ul {
  color: #856404;
  margin: 10px 0;
}

.analysis-summary li {
  margin: 8px 0;
  line-height: 1.5;
}

/* Technical Analysis Specific Styles */
.technical-container {
  margin: 30px 0;
}

.indicator-section {
  background: #f8f9fa;
  border-radius: 15px;
  margin: 25px 0;
  overflow: hidden;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
  border-left: 5px solid #007bff;
}

.indicator-header {
  background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
  color: white;
  padding: 20px 25px;
  margin: 0;
  font-size: 1.4em;
  font-weight: 500;
}

.indicator-content {
  padding: 25px;
}

.chart-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 20px;
  margin-bottom: 25px;
}

.individual-chart {
  background: white;
  border-radius: 10px;
  padding: 15px;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
}

.signal-messages {
  background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
  border-radius: 10px;
  padding: 20px;
  margin-top: 20px;
}

.signal-messages h4 {
  color: #155724;
  margin: 0 0 15px 0;
  font-size: 1.2em;
  display: flex;
  align-items: center;
  gap: 10px;
}

.signal-message {
  background: white;
  padding: 12px 16px;
  margin: 10px 0;
  border-radius: 8px;
  border-left: 4px solid #28a745;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
}

.buy-signal {
  border-left-color: #28a745;
  background: #f8fff8;
}

.sell-signal {
  border-left-color: #dc3545;
  background: #fff8f8;
}

.hold-signal {
  border-left-color: #ffc107;
  background: #fffcf0;
}

.metrics-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin: 20px 0;
}

.metric-card {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 20px;
  border-radius: 10px;
  text-align: center;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.metric-card h5 {
  margin: 0 0 10px 0;
  font-size: 0.9em;
  opacity: 0.9;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.metric-card .value {
  font-size: 1.5em;
  font-weight: bold;
}

@media (max-width: 768px) {
  .header-section {
    padding: 20px;
  }
  
  .header-section h1 {
    font-size: 2em;
  }
  
  .content-section {
    padding: 20px;
  }
  
  .info-cards {
    grid-template-columns: 1fr;
  }
  
  .indicator-content {
    padding: 15px;
  }
  
  .metrics-grid {
    grid-template-columns: 1fr;
  }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.loading-spinner {
  display: inline-block;
  width: 40px;
  height: 40px;
  border: 3px solid #f3f3f3;
  border-top: 3px solid #3498db;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}
</style>
{% endblock %}

{% block content %}
<div class="result-container">
  <!-- Header Section -->
  <div class="header-section">
    <h1>üìà Technical Analysis Results</h1>
    <div class="company-name">
      <strong>{{ symbol }}</strong>
      {% if company_name and company_name != symbol %}
      <br>{{ company_name }}
      {% endif %}
    </div>
    {% if start_date and end_date %}
    <div class="analysis-period">
      üìÖ Analysis Period: {{ start_date }} to {{ end_date }}
    </div>
    {% endif %}
  </div>

  <!-- Content Section -->
  <div class="content-section">
    
    <!-- Analysis Overview -->
    <div class="analysis-summary">
      <h3>üìä Analysis Overview</h3>
      <ul>
        <li><strong>Analysis Type:</strong> Technical Indicator Strategy</li>
        <li><strong>Indicators:</strong> {{ indicators|join(', ') if indicators else 'Multiple Technical Indicators' }}</li>
        <li><strong>Time Period:</strong> {{ term if term else 'Default' }} periods</li>
        <li><strong>Timeframe:</strong> {{ start_date }} to {{ end_date if end_date else 'Latest' }}</li>
      </ul>
    </div>

    <!-- Info Cards -->
    <div class="info-cards">
      <div class="info-card">
        <h3>Analysis Status</h3>
        <div class="value">‚úÖ Complete</div>
      </div>
      <div class="info-card">
        <h3>Indicators Used</h3>
        <div class="value">{{ indicators|length if indicators else 'N/A' }}</div>
      </div>
      <div class="info-card">
        <h3>Time Period</h3>
        <div class="value">{{ term if term else 'Auto' }}</div>
      </div>
      <div class="info-card">
        <h3>Data Points</h3>
        <div class="value">{{ data_points if data_points else 'N/A' }}</div>
      </div>
    </div>

    <!-- Technical Analysis Results -->
    {% if results %}
      <div class="technical-container">
        
        {% for indicator_name, indicator_data in results.items() %}
        <div class="indicator-section">
          <h2 class="indicator-header">
            {% if indicator_name == 'SMA' %}
              üìä Simple Moving Average (SMA)
            {% elif indicator_name == 'EMA' %}
              üìà Exponential Moving Average (EMA)
            {% elif indicator_name == 'MACD' %}
              üåä MACD (Moving Average Convergence Divergence)
            {% elif indicator_name == 'RSI' %}
              ‚ö° Relative Strength Index (RSI)
            {% elif indicator_name == 'Bollinger' %}
              üìê Bollinger Bands
            {% else %}
              üîß {{ indicator_name }}
            {% endif %}
          </h2>
          
          <div class="indicator-content">
            
            <!-- Charts Section -->
            <div class="chart-grid">
              {% if indicator_data.chart %}
                <div class="individual-chart">
                  {{ indicator_data.chart | safe }}
                </div>
              {% endif %}
              
              {% if indicator_data.candlestick_chart %}
                <div class="individual-chart">
                  <h4>Price Action</h4>
                  {{ indicator_data.candlestick_chart | safe }}
                </div>
              {% endif %}
              
              {% if indicator_data.macd_chart %}
                <div class="individual-chart">
                  <h4>MACD Indicator</h4>
                  {{ indicator_data.macd_chart | safe }}
                </div>
              {% endif %}
              
              {% if indicator_data.rsi_chart %}
                <div class="individual-chart">
                  <h4>RSI Indicator</h4>
                  {{ indicator_data.rsi_chart | safe }}
                </div>
              {% endif %}
            </div>

            <!-- Strategy Messages -->
            {% if indicator_data.messages %}
              <div class="signal-messages">
                <h4>üéØ Trading Signals & Recommendations</h4>
                {% for message in indicator_data.messages %}
                  <div class="signal-message 
                    {% if 'Buy' in message or 'buy' in message %}buy-signal
                    {% elif 'Sell' in message or 'sell' in message %}sell-signal
                    {% else %}hold-signal
                    {% endif %}">
                    {{ message | safe }}
                  </div>
                {% endfor %}
              </div>
            {% endif %}
            
            {% if indicator_data.strategy_notes %}
              <div class="signal-messages">
                <h4>üìù Strategy Notes</h4>
                {% for note in indicator_data.strategy_notes %}
                  <div class="signal-message">
                    {{ note | safe }}
                  </div>
                {% endfor %}
              </div>
            {% endif %}

          </div>
        </div>
        {% endfor %}

      </div>
    {% else %}
      <!-- Fallback for Support & Resistance or other analysis -->
      <div class="chart-container">
        <h2>üìà Strategy Analysis Chart</h2>
        {% if chart %}
          <div class="chart-wrapper">
            {{ chart | safe }}
          </div>
        {% else %}
          <div class="chart-wrapper" style="text-align: center; padding: 40px; color: #666;">
            <p>Chart data is being processed...</p>
            <div style="margin: 20px 0;">
              <div class="loading-spinner"></div>
            </div>
          </div>
        {% endif %}
      </div>

      <!-- Strategy Notes -->
      <div class="strategy-notes">
        <h2>üìù Strategy Recommendations & Notes</h2>
        
        {% if notes %}
          {% if notes is string %}
            <div class="note-item">
              <h4>Analysis Results</h4>
              <p>{{ notes }}</p>
            </div>
          {% elif notes is iterable %}
            {% for note in notes %}
              <div class="note-item">
                {% if note is mapping %}
                  <h4>{{ note.title or 'Strategy Note' }}</h4>
                  <p>{{ note.content or note.description or note }}</p>
                {% else %}
                  <h4>Strategy Insight</h4>
                  <p>{{ note | safe }}</p>
                {% endif %}
              </div>
            {% endfor %}
          {% endif %}
        {% else %}
          <div class="note-item">
            <h4>üîç Support Levels</h4>
            <p>Key support levels have been identified based on historical price action and volume analysis. These levels represent potential buying opportunities.</p>
          </div>
          
          <div class="note-item">
            <h4>üìä Resistance Levels</h4>
            <p>Resistance levels indicate where selling pressure may emerge. These are critical levels for profit-taking and risk management.</p>
          </div>
          
          <div class="note-item">
            <h4>üí° Trading Strategy</h4>
            <p>Consider buying near support levels with stops below, and selling near resistance levels. Monitor volume for confirmation of level breaks.</p>
          </div>
          
          <div class="note-item">
            <h4>‚ö†Ô∏è Risk Management</h4>
            <p>Always use proper position sizing and stop losses. Support and resistance levels are guides, not guarantees. Market conditions can change rapidly.</p>
          </div>
        {% endif %}
      </div>
    {% endif %}

    <!-- Technical Details -->
    <div class="analysis-summary">
      <h3>üîß Technical Details</h3>
      <ul>
        {% if results %}
          <li><strong>Analysis Method:</strong> Multi-indicator technical analysis</li>
          <li><strong>Indicators Applied:</strong> {{ results.keys() | list | join(', ') }}</li>
          <li><strong>Signal Generation:</strong> Crossover and threshold-based strategies</li>
          <li><strong>Time Period:</strong> {{ term if term else 'Optimized' }} periods for moving averages</li>
        {% else %}
          <li><strong>Calculation Method:</strong> Historical price pivot points and volume analysis</li>
          <li><strong>Timeframe Analyzed:</strong> Daily price data within selected range</li>
          <li><strong>Indicators Used:</strong> Price action, volume, and momentum analysis</li>
          <li><strong>Confidence Level:</strong> Based on number of touches and volume confirmation</li>
        {% endif %}
      </ul>
    </div>

  </div>
</div>
{% endblock %}