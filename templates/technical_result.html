<!-- templates/technical_result.html -->
{% extends "base.html" %}

{% block title %}Technical Analysis - {{ symbol }}{% endblock %}

{% block extra_css %}
<style>
.result-container {
  background: white;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  overflow: hidden;
}

.header-section {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 30px;
  text-align: center;
}

.header-section h1 {
  margin: 0;
  font-size: 2.5em;
  font-weight: 300;
}

.header-section .company-name {
  font-size: 1.2em;
  opacity: 0.9;
  margin-top: 10px;
}

.header-section .analysis-period {
  background: rgba(255, 255, 255, 0.2);
  display: inline-block;
  padding: 8px 16px;
  border-radius: 20px;
  margin-top: 15px;
  font-size: 0.9em;
}

.content-section {
  padding: 30px;
}

.parameters-card {
  background: #f8f9fa;
  border-radius: 10px;
  padding: 25px;
  margin-bottom: 30px;
  border-left: 4px solid #007bff;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.parameters-card h3 {
  color: #2c3e50;
  margin-top: 0;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.parameters-list {
  list-style: none;
  padding: 0;
}

.parameters-list li {
  background: white;
  padding: 12px 15px;
  margin: 8px 0;
  border-radius: 8px;
  border-left: 3px solid #007bff;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.parameters-list li strong {
  color: #2c3e50;
}

.indicators-section {
  background: #e8f5e8;
  border-radius: 10px;
  padding: 25px;
  margin: 30px 0;
  border-left: 4px solid #28a745;
}

.indicators-section h3 {
  color: #155724;
  margin-top: 0;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.indicator-result {
  background: white;
  padding: 15px;
  margin: 15px 0;
  border-radius: 8px;
  border-left: 3px solid #28a745;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
}

.indicator-result strong {
  color: #155724;
  display: block;
  margin-bottom: 5px;
}

.indicator-result .status {
  color: #28a745;
  font-weight: 500;
}

.charts-section {
  background: #fff3cd;
  border-radius: 10px;
  padding: 25px;
  margin: 30px 0;
  border-left: 4px solid #ffc107;
}

.charts-section h3 {
  color: #856404;
  margin-top: 0;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.chart-placeholder {
  background: white;
  padding: 40px;
  text-align: center;
  border-radius: 8px;
  border: 2px dashed #ffc107;
  color: #856404;
}

.chart-container {
  background: white;
  border-radius: 8px;
  padding: 15px;
  margin: 15px 0;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.info-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin: 30px 0;
}

.info-card {
  background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
  color: white;
  padding: 20px;
  border-radius: 10px;
  text-align: center;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s ease;
}

.info-card:hover {
  transform: translateY(-3px);
}

.info-card h4 {
  margin: 0 0 10px 0;
  font-size: 1.1em;
  opacity: 0.9;
}

.info-card .value {
  font-size: 1.8em;
  font-weight: bold;
}

@media (max-width: 768px) {
  .header-section {
    padding: 20px;
  }
  
  .header-section h1 {
    font-size: 2em;
  }
  
  .content-section {
    padding: 20px;
  }
  
  .info-cards {
    grid-template-columns: 1fr;
  }
}
</style>
{% endblock %}

{% block content %}
<div class="result-container">
  <!-- Header Section -->
  <div class="header-section">
    <h1>üìä Technical Analysis</h1>
    <div class="company-name">
      <strong>{{ symbol }}</strong>
      {% if company_name and company_name != symbol %}
      <br>{{ company_name }}
      {% endif %}
    </div>
    {% if start_date and end_date %}
    <div class="analysis-period">
      üìÖ Analysis Period: {{ start_date }} to {{ end_date }}
    </div>
    {% endif %}
  </div>

  <!-- Content Section -->
  <div class="content-section">
    
    <!-- Info Cards -->
    <div class="info-cards">
      <div class="info-card">
        <h4>Analysis Status</h4>
        <div class="value">‚úÖ Complete</div>
      </div>
      <div class="info-card">
        <h4>SMA/EMA Period</h4>
        <div class="value">{{ term or 10 }} days</div>
      </div>
      <div class="info-card">
        <h4>Indicators</h4>
        <div class="value">{{ indicators|length if indicators else 0 }}</div>
      </div>
      <div class="info-card">
        <h4>Data Points</h4>
        <div class="value">{{ data_points if data_points else 'N/A' }}</div>
      </div>
    </div>

    <!-- Parameters Card -->
    <div class="parameters-card">
      <h3>‚öôÔ∏è Analysis Parameters</h3>
      <ul class="parameters-list">
        <li><strong>Symbol:</strong> {{ symbol }} {% if company_name and company_name != symbol %}({{ company_name }}){% endif %}</li>
        <li><strong>Analysis Period:</strong> {{ start_date }} to {{ end_date }}</li>
        <li><strong>SMA/EMA Term:</strong> {{ term or 10 }} days</li>
        <li><strong>Selected Indicators:</strong> {{ indicators | join(', ') if indicators else 'None selected' }}</li>
      </ul>
    </div>

    <!-- Charts Section -->
    {% if charts %}
    <div class="charts-section">
      <h3>üìà Technical Analysis Charts</h3>
      {% for chart_name, chart_data in charts.items() %}
      <div class="chart-container">
        <h4 style="color: #856404; margin-bottom: 15px;">{{ chart_name | title }}</h4>

        {# Handle dict or string #}
        {% if chart_data is mapping %}
          {{ chart_data.chart | safe }}

          {% if chart_data.messages %}
          <ul class="analysis-messages">
            {% for msg in chart_data.messages %}
            <li style="margin: 5px 0; color: #856404;">{{ msg | safe }}</li>
            {% endfor %}
          </ul>
          {% endif %}
        {% else %}
          {{ chart_data | safe }}
        {% endif %}
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="charts-section">
      <h3>üìà Technical Analysis Charts</h3>
      <div class="chart-placeholder">
        <h4>Charts are being generated...</h4>
        <p>Technical analysis visualizations will appear here once processing is complete.</p>
      </div>
    </div>
    {% endif %}

    <!-- Indicators Results -->
    <div class="indicators-section">
      <h3>üìà Technical Indicators Results</h3>
      
      {% if indicators %}
        {% if 'SMA' in indicators %}
        <div class="indicator-result">
          <strong>Simple Moving Average ({{ term or 10 }} days):</strong>
          <span class="status">‚úÖ Analysis Complete</span>
          <p style="margin: 5px 0 0 0; color: #155724;">Trend analysis based on {{ term or 10 }}-day simple moving average has been calculated and visualized.</p>
        </div>
        {% endif %}
        
        {% if 'EMA' in indicators %}
        <div class="indicator-result">
          <strong>Exponential Moving Average ({{ term or 10 }} days):</strong>
          <span class="status">‚úÖ Analysis Complete</span>
          <p style="margin: 5px 0 0 0; color: #155724;">Exponential moving average provides more weight to recent prices for trend identification.</p>
        </div>
        {% endif %}
        
        {% if 'MACD' in indicators %}
        <div class="indicator-result">
          <strong>MACD (Moving Average Convergence Divergence):</strong>
          <span class="status">‚úÖ Analysis Complete</span>
          <p style="margin: 5px 0 0 0; color: #155724;">MACD analysis shows momentum changes and potential buy/sell signals.</p>
        </div>
        {% endif %}
        
        {% if 'RSI' in indicators %}
        <div class="indicator-result">
          <strong>RSI (Relative Strength Index):</strong>
          <span class="status">‚úÖ Analysis Complete</span>
          <p style="margin: 5px 0 0 0; color: #155724;">RSI analysis indicates overbought/oversold conditions for the selected period.</p>
        </div>
        {% endif %}
      {% else %}
        <div class="indicator-result">
          <strong>No Indicators Selected</strong>
          <p style="margin: 5px 0 0 0; color: #856404;">Please select one or more technical indicators from the sidebar to perform detailed analysis.</p>
        </div>
      {% endif %}
    </div>

  </div>
</div>
{% endblock %}
